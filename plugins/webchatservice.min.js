/*!
 * widgets
 * @version: 9.0.005.00
 * @license: Genesys Telecom Labs
 */
webpackJsonp([16],{"./webapp/lib/thirdparty/cometd.js":function(e,t,n){"use strict";var r,i,s,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(n,a){"object"===o(t)?e.exports=a():(i=[],r=a,void 0!==(s="function"==typeof r?r.apply(t,i):r)&&(e.exports=s))}(0,function(){var e={isString:function(e){return void 0!==e&&null!==e&&("string"==typeof e||e instanceof String)},isArray:function(e){return void 0!==e&&null!==e&&e instanceof Array},inArray:function(e,t){for(var n=0;n<t.length;++n)if(e===t[n])return n;return-1},setTimeout:function(e,t,n){return window.setTimeout(function(){try{e._debug("Invoking timed function",t),t()}catch(n){e._debug("Exception invoking timed function",t,n)}},n)},clearTimeout:function(e){window.clearTimeout(e)}},t=function(){var e=[],t={};this.getTransportTypes=function(){return e.slice(0)},this.findTransportTypes=function(n,r,i){for(var s=[],o=0;o<e.length;++o){var a=e[o];!0===t[a].accept(n,r,i)&&s.push(a)}return s},this.negotiateTransport=function(n,r,i,s){for(var o=0;o<e.length;++o)for(var a=e[o],c=0;c<n.length;++c)if(a===n[c]){var u=t[a];if(!0===u.accept(r,i,s))return u}return null},this.add=function(n,r,i){for(var s=!1,o=0;o<e.length;++o)if(e[o]===n){s=!0;break}return s||("number"!=typeof i?e.push(n):e.splice(i,0,n),t[n]=r),!s},this.find=function(n){for(var r=0;r<e.length;++r)if(e[r]===n)return t[n];return null},this.remove=function(n){for(var r=0;r<e.length;++r)if(e[r]===n){e.splice(r,1);var i=t[n];return delete t[n],i}return null},this.clear=function(){e=[],t={}},this.reset=function(n){for(var r=0;r<e.length;++r)t[e[r]].reset(n)}},n=function(){var t,n,r;this.registered=function(e,r){t=e,n=r},this.unregistered=function(){t=null,n=null},this._debug=function(){n._debug.apply(n,arguments)},this._mixin=function(){return n._mixin.apply(n,arguments)},this.getConfiguration=function(){return n.getConfiguration()},this.getAdvice=function(){return n.getAdvice()},this.setTimeout=function(t,r){return e.setTimeout(n,t,r)},this.clearTimeout=function(t){e.clearTimeout(t)},this.convertToMessages=function(t){if(e.isString(t))try{return JSON.parse(t)}catch(e){throw this._debug("Could not convert to JSON the following string",'"'+t+'"'),e}if(e.isArray(t))return t;if(void 0===t||null===t)return[];if(t instanceof Object)return[t];throw"Conversion Error "+t+", typeof "+(void 0===t?"undefined":o(t))},this.accept=function(e,t,n){throw"Abstract"},this.getType=function(){return t},this.getURL=function(){return r},this.setURL=function(e){r=e},this.send=function(e,t){throw"Abstract"},this.reset=function(e){this._debug("Transport",t,"reset",e?"initial":"retry")},this.abort=function(){this._debug("Transport",t,"aborted")},this.toString=function(){return this.getType()}};n.derive=function(e){function t(){}return t.prototype=e,new t};var r=function(){function t(e){for(;p.length>0;){var t=p[0],n=t[0],r=t[1];if(n.url!==e.url||n.sync!==e.sync)break;p.shift(),e.messages=e.messages.concat(n.messages),this._debug("Coalesced",n.messages.length,"messages from request",r.id)}}function r(e,t){if(this.transportSend(e,t),t.expired=!1,!e.sync){var n=this.getConfiguration().maxNetworkDelay,r=n;!0===t.metaConnect&&(r+=this.getAdvice().timeout),this._debug("Transport",this.getType(),"waiting at most",r,"ms for the response, maxNetworkDelay",n);var i=this;t.timeout=this.setTimeout(function(){t.expired=!0;var n="Request "+t.id+" of transport "+i.getType()+" exceeded "+r+" ms max network delay",s={reason:n},o=t.xhr;s.httpCode=i.xhrStatus(o),i.abortXHR(o),i._debug(n),i.complete(t,!1,t.metaConnect),e.onFailure(o,e.messages,s)},r)}}function i(e){var t=++d,n={id:t,metaConnect:!1,envelope:e};f.length<this.getConfiguration().maxConnections-1?(f.push(n),r.call(this,e,n)):(this._debug("Transport",this.getType(),"queueing request",t,"envelope",e),p.push([e,n]))}function s(e){var t=e.id;if(this._debug("Transport",this.getType(),"metaConnect complete, request",t),null!==l&&l.id!==t)throw"Longpoll request mismatch, completing request "+t;l=null}function o(n,r){var s=e.inArray(n,f);if(s>=0&&f.splice(s,1),p.length>0){var o=p.shift(),a=o[0],c=o[1];if(this._debug("Transport dequeued request",c.id),r)this.getConfiguration().autoBatch&&t.call(this,a),i.call(this,a),this._debug("Transport completed request",n.id,a);else{var u=this;this.setTimeout(function(){u.complete(c,!1,c.metaConnect);var e={reason:"Previous request failed"},t=c.xhr;e.httpCode=u.xhrStatus(t),a.onFailure(t,a.messages,e)},0)}}}function a(e){if(null!==l)throw"Concurrent metaConnect requests not allowed, request id="+l.id+" not yet completed";var t=++d;this._debug("Transport",this.getType(),"metaConnect send, request",t,"envelope",e);var n={id:t,metaConnect:!0,envelope:e};r.call(this,e,n),l=n}var c=new n,u=n.derive(c),d=0,l=null,f=[],p=[];return u.complete=function(e,t,n){n?s.call(this,e):o.call(this,e,t)},u.transportSend=function(e,t){throw"Abstract"},u.transportSuccess=function(e,t,n){t.expired||(this.clearTimeout(t.timeout),this.complete(t,!0,t.metaConnect),n&&n.length>0?e.onSuccess(n):e.onFailure(t.xhr,e.messages,{httpCode:204}))},u.transportFailure=function(e,t,n){t.expired||(this.clearTimeout(t.timeout),this.complete(t,!1,t.metaConnect),e.onFailure(t.xhr,e.messages,n))},u.send=function(e,t){t?a.call(this,e):i.call(this,e)},u.abort=function(){c.abort();for(var e=0;e<f.length;++e){var t=f[e];t&&(this._debug("Aborting request",t),this.abortXHR(t.xhr)||this.transportFailure(t.envelope,t,{reason:"abort"}))}var n=l;n&&(this._debug("Aborting metaConnect request",n),this.abortXHR(n.xhr)||this.transportFailure(n.envelope,n,{reason:"abort"})),this.reset(!0)},u.reset=function(e){c.reset(e),l=null,f=[],p=[]},u.abortXHR=function(e){if(e)try{var t=e.readyState;return e.abort(),t!==window.XMLHttpRequest.UNSENT}catch(e){this._debug(e)}return!1},u.xhrStatus=function(e){if(e)try{return e.status}catch(e){this._debug(e)}return-1},u},i=function(){var e=new r,t=n.derive(e),i=!0;return t.accept=function(e,t,n){return i||!t},t.newXMLHttpRequest=function(){return new window.XMLHttpRequest},t.xhrSend=function(e){var n=t.newXMLHttpRequest();n.context=t.context,n.withCredentials=!0,n.open("POST",e.url,!0!==e.sync);var r=e.headers;if(r)for(var i in r)r.hasOwnProperty(i)&&n.setRequestHeader(i,r[i]);return n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.onload=function(){200===n.status?e.onSuccess(n.responseText):e.onError(n.statusText)},n.onerror=function(){e.onError(n.statusText)},n.send(e.body),n},t.transportSend=function(e,t){this._debug("Transport",this.getType(),"sending request",t.id,"envelope",e);var n=this;try{var r=!0;t.xhr=this.xhrSend({transport:this,url:e.url,sync:e.sync,headers:this.getConfiguration().requestHeaders,body:JSON.stringify(e.messages),onSuccess:function(r){n._debug("Transport",n.getType(),"received response",r);var s=!1;try{var o=n.convertToMessages(r);0===o.length?(i=!1,n.transportFailure(e,t,{httpCode:204})):(s=!0,n.transportSuccess(e,t,o))}catch(r){if(n._debug(r),!s){i=!1;var a={exception:r};a.httpCode=n.xhrStatus(t.xhr),n.transportFailure(e,t,a)}}},onError:function(s,o){n._debug("Transport",n.getType(),"received error",s,o),i=!1;var a={reason:s,exception:o};a.httpCode=n.xhrStatus(t.xhr),r?n.setTimeout(function(){n.transportFailure(e,t,a)},0):n.transportFailure(e,t,a)}}),r=!1}catch(r){i=!1,this.setTimeout(function(){n.transportFailure(e,t,{exception:r})},0)}},t.reset=function(t){e.reset(t),i=!0},t},s=function(){function e(e,t,n){var r=this;return function(){r.transportFailure(e,t,"error",n)}}var t=new r,i=n.derive(t),s=0;return i.accept=function(e,t,n){return!0},i.jsonpSend=function(e){var t=document.getElementsByTagName("head")[0],n=document.createElement("script"),r="_cometd_jsonp_"+s++;window[r]=function(i){t.removeChild(n),delete window[r],e.onSuccess(i)};var i=e.url;i+=i.indexOf("?")<0?"?":"&",i+="jsonp="+r,i+="&message="+e.body,n.src=i,n.async=!0!==e.sync,n.type="application/javascript",n.onerror=function(t){e.onError("jsonp "+t.type)},t.appendChild(n)},i.transportSend=function(t,n){for(var r=this,i=0,s=t.messages.length,o=[];s>0;){var a=JSON.stringify(t.messages.slice(i,i+s)),c=t.url.length+encodeURI(a).length,u=this.getConfiguration().maxURILength;if(c>u){if(1===s){var d="Bayeux message too big ("+c+" bytes, max is "+u+") for transport "+this.getType();return void this.setTimeout(e.call(this,t,n,d),0)}--s}else o.push(s),i+=s,s=t.messages.length-i}var l=t;if(o.length>1){var f=0,p=o[0];this._debug("Transport",this.getType(),"split",t.messages.length,"messages into",o.join(" + ")),l=this._mixin(!1,{},t),l.messages=t.messages.slice(f,p),l.onSuccess=t.onSuccess,l.onFailure=t.onFailure;for(var h=1;h<o.length;++h){var g=this._mixin(!1,{},t);f=p,p+=o[h],g.messages=t.messages.slice(f,p),g.onSuccess=t.onSuccess,g.onFailure=t.onFailure,this.send(g,n.metaConnect)}}this._debug("Transport",this.getType(),"sending request",n.id,"envelope",l);try{var m=!0;this.jsonpSend({transport:this,url:l.url,sync:l.sync,headers:this.getConfiguration().requestHeaders,body:JSON.stringify(l.messages),onSuccess:function(e){var t=!1;try{var i=r.convertToMessages(e);0===i.length?r.transportFailure(l,n,{httpCode:204}):(t=!0,r.transportSuccess(l,n,i))}catch(e){r._debug(e),t||r.transportFailure(l,n,{exception:e})}},onError:function(e,t){var i={reason:e,exception:t};m?r.setTimeout(function(){r.transportFailure(l,n,i)},0):r.transportFailure(l,n,i)}}),m=!1}catch(e){this.setTimeout(function(){r.transportFailure(l,n,{exception:e})},0)}},i},a=function(){function t(e,t){e&&(this.webSocketClose(e,t.code,t.reason),this.onClose(e,t))}function r(e){return e===g||e===h}function i(e,t,n){for(var r=[],i=0;i<t.messages.length;++i){var s=t.messages[i];s.id&&r.push(s.id)}e.envelopes[r.join(",")]=[t,n],this._debug("Transport",this.getType(),"stored envelope, envelopes",e.envelopes)}function s(e){if(!g){var n=c.getURL().replace(/^http/,"ws");this._debug("Transport",this.getType(),"connecting to URL",n);try{var i=c.getConfiguration().protocol;e.webSocket=i?new window.WebSocket(n,i):new window.WebSocket(n),g=e}catch(e){throw l=!1,this._debug("Exception while creating WebSocket object",e),e}p=!1!==c.getConfiguration().stickyReconnect;var s=this,o=c.getConfiguration().connectTimeout;o>0&&(e.connectTimer=this.setTimeout(function(){c._debug("Transport",s.getType(),"timed out while connecting to URL",n,":",o,"ms"),t.call(s,e,{code:1e3,reason:"Connect Timeout"})},o));var a=function(){c._debug("WebSocket onopen",e),e.connectTimer&&s.clearTimeout(e.connectTimer),r(e)?(g=null,h=e,f=!0,s.onOpen(e)):(c._warn("Closing extra WebSocket connection",this,"active connection",h),t.call(s,e,{code:1e3,reason:"Extra Connection"}))},u=function(t){t=t||{code:1e3},c._debug("WebSocket onclose",e,t,"connecting",g,"current",h),e.connectTimer&&s.clearTimeout(e.connectTimer),s.onClose(e,t)},d=function(t){c._debug("WebSocket onmessage",t,e),s.onMessage(e,t)};e.webSocket.onopen=a,e.webSocket.onclose=u,e.webSocket.onerror=function(){u({code:1e3,reason:"Error"})},e.webSocket.onmessage=d,this._debug("Transport",this.getType(),"configured callbacks on",e)}}function o(e,n,r){var i=JSON.stringify(n.messages);e.webSocket.send(i),this._debug("Transport",this.getType(),"sent",n,"metaConnect =",r);var s=this.getConfiguration().maxNetworkDelay,o=s;r&&(o+=this.getAdvice().timeout,m=!0);for(var a=this,u=[],d=0;d<n.messages.length;++d)!function(){var r=n.messages[d];r.id&&(u.push(r.id),e.timeouts[r.id]=a.setTimeout(function(){c._debug("Transport",a.getType(),"timing out message",r.id,"after",o,"on",e),t.call(a,e,{code:1e3,reason:"Message Timeout"})},o))}();this._debug("Transport",this.getType(),"waiting at most",o,"ms for messages",u,"maxNetworkDelay",s,", timeouts:",e.timeouts)}function a(e,n,r){try{null===e?(e=g||{envelopes:{},timeouts:{}},i.call(this,e,n,r),s.call(this,e)):(i.call(this,e,n,r),o.call(this,e,n,r))}catch(n){var a=this;this.setTimeout(function(){t.call(a,e,{code:1e3,reason:"Exception",exception:n})},0)}}var c,u=new n,d=n.derive(u),l=!0,f=!1,p=!0,h=null,g=null,m=!1,v=null;return d.reset=function(e){u.reset(e),l=!0,e&&(f=!1),p=!0,h=null,g=null,m=!1},d._notifySuccess=function(e,t){e.call(this,t)},d._notifyFailure=function(e,t,n,r){e.call(this,t,n,r)},d.onOpen=function(e){var t=e.envelopes;this._debug("Transport",this.getType(),"opened",e,"pending messages",t);for(var n in t)if(t.hasOwnProperty(n)){var r=t[n],i=r[0],s=r[1];v=i.onSuccess,o.call(this,e,i,s)}},d.onMessage=function(t,n){this._debug("Transport",this.getType(),"received websocket message",n,t);for(var r=!1,i=this.convertToMessages(n.data),s=[],o=0;o<i.length;++o){var a=i[o];if((/^\/meta\//.test(a.channel)||void 0===a.data)&&a.id){s.push(a.id);var c=t.timeouts[a.id];c&&(this.clearTimeout(c),delete t.timeouts[a.id],this._debug("Transport",this.getType(),"removed timeout for message",a.id,", timeouts",t.timeouts))}"/meta/connect"===a.channel&&(m=!1),"/meta/disconnect"!==a.channel||m||(r=!0)}for(var u=!1,d=t.envelopes,l=0;l<s.length;++l){var f=s[l];for(var p in d)if(d.hasOwnProperty(p)){var h=p.split(","),g=e.inArray(f,h);if(g>=0){u=!0,h.splice(g,1);var b=d[p][0],y=d[p][1];delete d[p],h.length>0&&(d[h.join(",")]=[b,y]);break}}}u&&this._debug("Transport",this.getType(),"removed envelope, envelopes",d),this._notifySuccess(v,i),r&&this.webSocketClose(t,1e3,"Disconnect")},d.onClose=function(e,t){this._debug("Transport",this.getType(),"closed",e,t),r(e)&&(l=p&&f,g=null,h=null);var n=e.timeouts;e.timeouts={};for(var i in n)n.hasOwnProperty(i)&&this.clearTimeout(n[i]);var s=e.envelopes;e.envelopes={};for(var o in s)if(s.hasOwnProperty(o)){var a=s[o][0],c=s[o][1];c&&(m=!1);var u={websocketCode:t.code,reason:t.reason};t.exception&&(u.exception=t.exception),this._notifyFailure(a.onFailure,e,a.messages,u)}},d.registered=function(e,t){u.registered(e,t),c=t},d.accept=function(e,t,n){return this._debug("Transport",this.getType(),"accept, supported:",l),l&&!!window.WebSocket&&!1!==c.websocketEnabled},d.send=function(e,t){this._debug("Transport",this.getType(),"sending",e,"metaConnect =",t),a.call(this,h,e,t)},d.webSocketClose=function(e,t,n){try{e.webSocket&&e.webSocket.close(t,n)}catch(e){this._debug(e)}},d.abort=function(){u.abort(),t.call(this,h,{code:1e3,reason:"Abort"}),this.reset(!0)},d},c=function(n){function r(e,t){try{return e[t]}catch(e){return}}function c(t){return e.isString(t)}function u(e){return void 0!==e&&null!==e&&"function"==typeof e}function d(e,t){for(var n="";--t>0&&!(e>=Math.pow(10,t));)n+="0";return n+=e}function l(e,t){if(window.console){var n=window.console[e];if(u(n)){var r=new Date;[].splice.call(t,0,0,d(r.getHours(),2)+":"+d(r.getMinutes(),2)+":"+d(r.getSeconds(),2)+"."+d(r.getMilliseconds(),3)),n.apply(window.console,t)}}}function f(e){return/(^https?:\/\/)?(((\[[^\]]+\])|([^:\/\?#]+))(:(\d+))?)?([^\?#]*)(.*)?/.exec(e)}function p(e){me._debug("Configuring cometd object with",e),c(e)&&(e={url:e}),e||(e={}),Fe=me._mixin(!1,Fe,e);var t=me.getURL();if(!t)throw"Missing required configuration parameter 'url' specifying the Bayeux server URL";var n=f(t),r=n[2],i=n[8],s=n[9];if(be=me._isCrossDomain(r),Fe.appendMessageTypeToURL)if(void 0!==s&&s.length>0)me._info("Appending message type to URI "+i+s+" is not supported, disabling 'appendMessageTypeToURL' configuration"),Fe.appendMessageTypeToURL=!1;else{var o=i.split("/"),a=o.length-1;i.match(/\/$/)&&(a-=1),o[a].indexOf(".")>=0&&(me._info("Appending message type to URI "+i+" is not supported, disabling 'appendMessageTypeToURL' configuration"),Fe.appendMessageTypeToURL=!1)}}function h(e){if(e){var t=Ie[e.channel];t&&t[e.id]&&(delete t[e.id],me._debug("Removed",e.listener?"listener":"subscription",e))}}function g(e){e&&!e.listener&&h(e)}function m(){for(var e in Ie)if(Ie.hasOwnProperty(e)){var t=Ie[e];if(t)for(var n in t)t.hasOwnProperty(n)&&g(t[n])}}function v(e){Te!==e&&(me._debug("Status",Te,"->",e),Te=e)}function b(){return"disconnecting"===Te||"disconnected"===Te}function y(){return""+ ++we}function T(e,t,n,r,i){try{return t.call(e,r)}catch(e){var s=me.onExtensionException;if(u(s)){me._debug("Invoking extension exception handler",n,e);try{s.call(me,e,n,i,r)}catch(e){me._info("Exception during execution of extension exception handler",n,e)}}else me._info("Exception during execution of extension",n,e);return r}}function w(e){for(var t=0;t<Pe.length&&void 0!==e&&null!==e;++t){var n=Pe[t],r=n.extension.incoming;if(u(r)){var i=T(n.extension,r,n.name,e,!1);e=void 0===i?e:i}}return e}function x(e){for(var t=Pe.length-1;t>=0&&void 0!==e&&null!==e;--t){var n=Pe[t],r=n.extension.outgoing;if(u(r)){var i=T(n.extension,r,n.name,e,!0);e=void 0===i?e:i}}return e}function C(e,t){var n=Ie[e];if(n)for(var r in n)if(n.hasOwnProperty(r)){var i=n[r];if(i)try{i.callback.call(i.scope,t)}catch(e){var s=me.onListenerException;if(u(s)){me._debug("Invoking listener exception handler",i,e);try{s.call(me,e,i,i.listener,t)}catch(e){me._info("Exception during execution of listener exception handler",i,e)}}else me._info("Exception during execution of listener",i,t,e)}}}function k(e,t){C(e,t);for(var n=e.split("/"),r=n.length-1,i=r;i>0;--i){var s=n.slice(0,i).join("/")+"/*";i===r&&C(s,t),s+="*",C(s,t)}}function S(){null!==De&&e.clearTimeout(De),De=null}function _(t,n){S();var r=Le.interval+n;me._debug("Function scheduled in",r,"ms, interval =",Le.interval,"backoff =",je,t),De=e.setTimeout(me,t,r)}function I(e,t,n,r){for(var i=0;i<t.length;++i){var s=t[i],o=s.id;xe&&(s.clientId=xe),s=x(s),void 0!==s&&null!==s?(s.id=o,t[i]=s):(delete Oe[o],t.splice(i--,1))}if(0!==t.length){var a=me.getURL();Fe.appendMessageTypeToURL&&(a.match(/\/$/)||(a+="/"),r&&(a+=r));var c={url:a,sync:e,messages:t,onSuccess:function(e){try{Ne.call(me,e)}catch(e){me._info("Exception during handling of messages",e)}},onFailure:function(e,t,n){try{var r=me.getTransport();n.connectionType=r?r.getType():"unknown",Me.call(me,e,t,n)}catch(e){me._info("Exception during handling of failure",e)}}};me._debug("Send",c),pe.send(c,n)}}function j(e){Ce>0||!0===Se?ke.push(e):I(!1,[e],!1)}function D(){je=0}function P(){return je<Fe.maxBackoff&&(je+=Fe.backoffIncrement),je}function L(){++Ce,me._debug("Starting batch, depth",Ce)}function O(){var e=ke;ke=[],e.length>0&&I(!1,e,!1)}function R(){if(--Ce,me._debug("Ending batch, depth",Ce),Ce<0)throw"Calls to startBatch() and endBatch() are not paired";0!==Ce||b()||Se||O()}function A(){if(!b()){var e={id:y(),channel:"/meta/connect",connectionType:pe.getType()};Ee||(e.advice={timeout:0}),v("connecting"),me._debug("Connect sent",e),I(!1,[e],!0,"connect"),v("connected")}}function E(e){v("connecting"),_(function(){A()},e)}function U(e){e&&(Le=me._mixin(!1,{},Fe.advice,e),me._debug("New advice",Le))}function q(e){if(S(),e&&pe&&pe.abort(),xe=null,v("disconnected"),Ce=0,D(),pe=null,Ae=!1,Ee=!1,ke.length>0){var t=ke;ke=[],Me.call(me,void 0,t,{reason:"Disconnected"})}}function F(e,t,n){var r=me.onTransportException;if(u(r)){me._debug("Invoking transport exception handler",e,t,n);try{r.call(me,n,e,t)}catch(e){me._info("Exception during execution of transport exception handler",e)}}}function N(e,t){u(e)&&(t=e,e=void 0),xe=null,m(),b()&&ye.reset(!0),U({}),Ce=0,Se=!0,he=e,ge=t;var n=me.getURL(),r=ye.findTransportTypes("1.0",be,n),i={id:y(),version:"1.0",minimumVersion:"1.0",channel:"/meta/handshake",supportedConnectionTypes:r,advice:{timeout:Le.timeout,interval:Le.interval}},s=me._mixin(!1,{},he,i);if(me._putCallback(s.id,t),!pe&&!(pe=ye.negotiateTransport(r,"1.0",be,n))){var o="Could not find initial transport among: "+ye.getTransportTypes();throw me._warn(o),o}me._debug("Initial transport is",pe.getType()),v("handshaking"),me._debug("Handshake sent",s),I(!1,[s],!1,"handshake")}function M(e){v("handshaking"),Se=!0,_(function(){N(he,ge)},e)}function K(e,t){try{e.call(me,t)}catch(e){var n=me.onCallbackException;if(u(n)){me._debug("Invoking callback exception handler",e);try{n.call(me,e,t)}catch(e){me._info("Exception during execution of callback exception handler",e)}}else me._info("Exception during execution of message callback",e)}}function B(e){var t=me._getCallback([e.id]);u(t)&&(delete Oe[e.id],K(t,e))}function H(t){var n=Re[t.id];if(delete Re[t.id],n){me._debug("Handling remote call response for",t,"with context",n);var r=n.timeout;r&&e.clearTimeout(r);var i=n.callback;if(u(i))return K(i,t),!0}return!1}function W(e){me._debug("Transport failure handling",e),e.transport&&(pe=e.transport),e.url&&pe.setURL(e.url);var t=e.action,n=e.delay||0;switch(t){case"handshake":M(n);break;case"retry":E(n);break;case"none":q(!0);break;default:throw"Unknown action "+t}}function J(e,t){B(e),k("/meta/handshake",e),k("/meta/unsuccessful",e),b()&&(t.action="none"),me.onTransportFailure.call(me,e,t,W)}function z(e){var t=me.getURL();if(e.successful){var n=me._isCrossDomain(f(t)[2]),r=ye.negotiateTransport(e.supportedConnectionTypes,e.version,n,t);if(null===r)return e.successful=!1,void J(e,{cause:"negotiation",action:"none",transport:null});pe!==r&&(me._debug("Transport",pe.getType(),"->",r.getType()),pe=r),xe=e.clientId,Se=!1,O(),e.reestablish=Ae,Ae=!0,B(e),k("/meta/handshake",e),qe=e["x-messages"]||0;var i=b()?"none":Le.reconnect||"retry";switch(i){case"retry":D(),0===qe?E(0):me._debug("Processing",qe,"handshake-delivered messages");break;case"none":q(!0);break;default:throw"Unrecognized advice action "+i}}else J(e,{cause:"unsuccessful",action:Le.reconnect||"handshake",transport:pe})}function X(e){J(e,{cause:"failure",action:"handshake",transport:null})}function G(e,t){k("/meta/connect",e),k("/meta/unsuccessful",e),b()&&(t.action="none"),me.onTransportFailure.call(me,e,t,W)}function V(e){if(Ee=e.successful){k("/meta/connect",e);var t=b()?"none":Le.reconnect||"retry";switch(t){case"retry":D(),E(je);break;case"none":q(!1);break;default:throw"Unrecognized advice action "+t}}else G(e,{cause:"unsuccessful",action:Le.reconnect||"retry",transport:pe})}function $(e){Ee=!1,G(e,{cause:"failure",action:"retry",transport:null})}function Z(e){q(!0),B(e),k("/meta/disconnect",e),k("/meta/unsuccessful",e)}function Q(e){e.successful?(q(!1),B(e),k("/meta/disconnect",e)):Z(e)}function Y(e){Z(e)}function ee(e){var t=Ie[e.subscription];if(t)for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];r&&!r.listener&&(delete t[n],me._debug("Removed failed subscription",r))}B(e),k("/meta/subscribe",e),k("/meta/unsuccessful",e)}function te(e){e.successful?(B(e),k("/meta/subscribe",e)):ee(e)}function ne(e){ee(e)}function re(e){B(e),k("/meta/unsubscribe",e),k("/meta/unsuccessful",e)}function ie(e){e.successful?(B(e),k("/meta/unsubscribe",e)):re(e)}function se(e){re(e)}function oe(e){H(e)||(B(e),k("/meta/publish",e),k("/meta/unsuccessful",e))}function ae(e){void 0!==e.data?H(e)||(k(e.channel,e),qe>0&&0==--qe&&(me._debug("Processed last handshake-delivered message"),E(0))):void 0===e.successful?me._warn("Unknown Bayeux Message",e):e.successful?(B(e),k("/meta/publish",e)):oe(e)}function ce(e){oe(e)}function ue(e){if(Ue=0,void 0!==(e=w(e))&&null!==e)switch(U(e.advice),e.channel){case"/meta/handshake":z(e);break;case"/meta/connect":V(e);break;case"/meta/disconnect":Q(e);break;case"/meta/subscribe":te(e);break;case"/meta/unsubscribe":ie(e);break;default:ae(e)}}function de(e){var t=Ie[e];if(t)for(var n in t)if(t.hasOwnProperty(n)&&t[n])return!0;return!1}function le(e,t){var n={scope:e,method:t};if(u(e))n.scope=void 0,n.method=e;else if(c(t)){if(!e)throw"Invalid scope "+e;if(n.method=e[t],!u(n.method))throw"Invalid callback "+t+" for scope "+e}else if(!u(t))throw"Invalid callback "+t;return n}function fe(e,t,n,r){var i=le(t,n);me._debug("Adding",r?"listener":"subscription","on",e,"with scope",i.scope,"and callback",i.method);var s=++_e,o={id:s,channel:e,scope:i.scope,callback:i.method,listener:r},a=Ie[e];return a||(a={},Ie[e]=a),a[s]=o,me._debug("Added",r?"listener":"subscription",o),o}var pe,he,ge,me=this,ve=n||"default",be=!1,ye=new t,Te="disconnected",we=0,xe=null,Ce=0,ke=[],Se=!1,_e=0,Ie={},je=0,De=null,Pe=[],Le={},Oe={},Re={},Ae=!1,Ee=!1,Ue=0,qe=0,Fe={protocol:null,stickyReconnect:!0,connectTimeout:0,maxConnections:2,backoffIncrement:1e3,maxBackoff:6e4,logLevel:"info",maxNetworkDelay:1e4,requestHeaders:{},appendMessageTypeToURL:!0,autoBatch:!1,urls:{},maxURILength:2e3,advice:{timeout:6e4,interval:0,reconnect:void 0,maxInterval:0}};this._mixin=function(e,t,n){for(var i=t||{},s=2;s<arguments.length;++s){var a=arguments[s];if(void 0!==a&&null!==a)for(var c in a)if(a.hasOwnProperty(c)){var u=r(a,c),d=r(i,c);if(u===t)continue;if(void 0===u)continue;if(e&&"object"===(void 0===u?"undefined":o(u))&&null!==u)if(u instanceof Array)i[c]=this._mixin(e,d instanceof Array?d:[],u);else{var l="object"!==(void 0===d?"undefined":o(d))||d instanceof Array?{}:d;i[c]=this._mixin(e,l,u)}else i[c]=u}}return i},this._warn=function(){l("warn",arguments)},this._info=function(){"warn"!==Fe.logLevel&&l("info",arguments)},this._debug=function(){"debug"===Fe.logLevel&&l("debug",arguments)},this._isCrossDomain=function(e){return!!(window.location&&window.location.host&&e)&&e!==window.location.host};var Ne,Me;this.send=j,this._getCallback=function(e){return Oe[e]},this._putCallback=function(e,t){var n=this._getCallback(e);return u(t)&&(Oe[e]=t),n},this.onTransportFailure=function(e,t,n){this._debug("Transport failure",t,"for",e);var r=this.getTransportRegistry(),i=this.getURL(),s=this._isCrossDomain(f(i)[2]),o=r.findTransportTypes("1.0",s,i);if("none"===t.action){if("/meta/handshake"===e.channel&&!t.transport){var a="Could not negotiate transport, client=["+o+"], server=["+e.supportedConnectionTypes+"]";this._warn(a),F(pe.getType(),null,{reason:a,connectionType:pe.getType(),transport:pe})}}else if(t.delay=this.getBackoffPeriod(),"/meta/handshake"===e.channel){if(!t.transport){var c=r.negotiateTransport(o,"1.0",s,i);c?(this._debug("Transport",pe.getType(),"->",c.getType()),F(pe.getType(),c.getType(),e.failure),t.action="handshake",t.transport=c):(this._warn("Could not negotiate transport, client=["+o+"]"),F(pe.getType(),null,e.failure),t.action="none")}"none"!==t.action&&this.increaseBackoffPeriod()}else{var u=(new Date).getTime();if(0===Ue&&(Ue=u),"retry"===t.action){t.delay=this.increaseBackoffPeriod();var d=Le.maxInterval;if(d>0){var l=Le.timeout+Le.interval+d,p=u-Ue;p+je>l&&(t.action="handshake")}}"handshake"===t.action&&(t.delay=0,r.reset(!1),this.resetBackoffPeriod())}n.call(me,t)},this.receive=ue,Ne=function(e){me._debug("Received",e);for(var t=0;t<e.length;++t)ue(e[t])},Me=function(e,t,n){me._debug("handleFailure",e,t,n),n.transport=e;for(var r=0;r<t.length;++r){var i=t[r],s={id:i.id,successful:!1,channel:i.channel,failure:n};switch(n.message=i,i.channel){case"/meta/handshake":X(s);break;case"/meta/connect":$(s);break;case"/meta/disconnect":Y(s);break;case"/meta/subscribe":s.subscription=i.subscription,ne(s);break;case"/meta/unsubscribe":s.subscription=i.subscription,se(s);break;default:ce(s)}}},this.registerTransport=function(e,t,n){var r=ye.add(e,t,n);return r&&(this._debug("Registered transport",e),u(t.registered)&&t.registered(e,this)),r},this.unregisterTransport=function(e){var t=ye.remove(e);return null!==t&&(this._debug("Unregistered transport",e),u(t.unregistered)&&t.unregistered()),t},this.unregisterTransports=function(){ye.clear()},this.getTransportTypes=function(){return ye.getTransportTypes()},this.findTransport=function(e){return ye.find(e)},this.getTransportRegistry=function(){return ye},this.configure=function(e){p.call(this,e)},this.init=function(e,t){this.configure(e),this.handshake(t)},this.handshake=function(e,t){if("disconnected"!==Te)throw"Illegal state: handshaken";N(e,t)},this.disconnect=function(e,t,n){if(!b()){"boolean"!=typeof e&&(n=t,t=e,e=!1),u(t)&&(n=t,t=void 0);var r={id:y(),channel:"/meta/disconnect"},i=this._mixin(!1,{},t,r);me._putCallback(i.id,n),v("disconnecting"),I(!0===e,[i],!1,"disconnect")}},this.startBatch=function(){L()},this.endBatch=function(){R()},this.batch=function(e,t){var n=le(e,t);this.startBatch();try{n.method.call(n.scope),this.endBatch()}catch(e){throw this._info("Exception during execution of batch",e),this.endBatch(),e}},this.addListener=function(e,t,n){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!c(e))throw"Illegal argument type: channel must be a string";return fe(e,t,n,!0)},this.removeListener=function(e){if(!(e&&e.channel&&"id"in e))throw"Invalid argument: expected subscription, not "+e;h(e)},this.clearListeners=function(){Ie={}},this.subscribe=function(e,t,n,r,i){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!c(e))throw"Illegal argument type: channel must be a string";if(b())throw"Illegal state: disconnected";u(t)&&(i=r,r=n,n=t,t=void 0),u(r)&&(i=r,r=void 0);var s=!de(e),o=fe(e,t,n,!1);if(s){var a={id:y(),channel:"/meta/subscribe",subscription:e},d=this._mixin(!1,{},r,a);me._putCallback(d.id,i),j(d)}return o},this.unsubscribe=function(e,t,n){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(b())throw"Illegal state: disconnected";u(t)&&(n=t,t=void 0),this.removeListener(e);var r=e.channel;if(!de(r)){var i={id:y(),channel:"/meta/unsubscribe",subscription:r},s=this._mixin(!1,{},t,i);me._putCallback(s.id,n),j(s)}},this.resubscribe=function(e,t){if(g(e),e)return this.subscribe(e.channel,e.scope,e.callback,t)},this.clearSubscriptions=function(){m()},this.publish=function(e,t,n,r){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!c(e))throw"Illegal argument type: channel must be a string";if(/^\/meta\//.test(e))throw"Illegal argument: cannot publish to meta channels";if(b())throw"Illegal state: disconnected";u(t)?(r=t,t={},n=void 0):u(n)&&(r=n,n=void 0);var i={id:y(),channel:e,data:t},s=this._mixin(!1,{},n,i);me._putCallback(s.id,r),j(s)},this.publishBinary=function(e,t,n,r,i){u(t)?(i=t,t=new ArrayBuffer(0),n=!0,r=void 0):u(n)?(i=n,n=!0,r=void 0):u(r)&&(i=r,r=void 0);var s={meta:r,data:t,last:n},o={ext:{binary:{}}};this.publish(e,s,o,i)},this.remoteCall=function(t,n,r,i,s){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!c(t))throw"Illegal argument type: target must be a string";if(b())throw"Illegal state: disconnected";if(u(n)?(s=n,n={},r=Fe.maxNetworkDelay,i=void 0):u(r)?(s=r,r=Fe.maxNetworkDelay,i=void 0):u(i)&&(s=i,i=void 0),"number"!=typeof r)throw"Illegal argument type: timeout must be a number";t.match(/^\//)||(t="/"+t);var o="/service"+t,a={id:y(),channel:o,data:n},d=this._mixin(!1,{},i,a),l={callback:s};r>0&&(l.timeout=e.setTimeout(me,function(){me._debug("Timing out remote call",d,"after",r,"ms"),oe({id:d.id,error:"406::timeout",successful:!1,failure:{message:d,reason:"Remote Call Timeout"}})},r),me._debug("Scheduled remote call timeout",d,"in",r,"ms")),Re[d.id]=l,j(d)},this.remoteCallBinary=function(e,t,n,r,i,s){u(t)?(s=t,t=new ArrayBuffer(0),n=!0,r=void 0,i=Fe.maxNetworkDelay):u(n)?(s=n,n=!0,r=void 0,i=Fe.maxNetworkDelay):u(r)?(s=r,r=void 0,i=Fe.maxNetworkDelay):u(i)&&(s=i,i=Fe.maxNetworkDelay);var o={meta:r,data:t,last:n},a={ext:{binary:{}}};this.remoteCall(e,o,i,a,s)},this.getStatus=function(){return Te},this.isDisconnected=b,this.setBackoffIncrement=function(e){Fe.backoffIncrement=e},this.getBackoffIncrement=function(){return Fe.backoffIncrement},this.getBackoffPeriod=function(){return je},this.increaseBackoffPeriod=function(){return P()},this.resetBackoffPeriod=function(){D()},this.setLogLevel=function(e){Fe.logLevel=e},this.registerExtension=function(e,t){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!c(e))throw"Illegal argument type: extension name must be a string";for(var n=!1,r=0;r<Pe.length;++r)if(Pe[r].name===e){n=!0;break}return n?(this._info("Could not register extension with name",e,"since another extension with the same name already exists"),!1):(Pe.push({name:e,extension:t}),this._debug("Registered extension",e),u(t.registered)&&t.registered(e,this),!0)},this.unregisterExtension=function(e){if(!c(e))throw"Illegal argument type: extension name must be a string";for(var t=!1,n=0;n<Pe.length;++n){var r=Pe[n];if(r.name===e){Pe.splice(n,1),t=!0,this._debug("Unregistered extension",e);var i=r.extension;u(i.unregistered)&&i.unregistered();break}}return t},this.getExtension=function(e){for(var t=0;t<Pe.length;++t){var n=Pe[t];if(n.name===e)return n.extension}return null},this.getName=function(){return ve},this.getClientId=function(){return xe},this.getURL=function(){if(pe){var e=pe.getURL();if(e)return e;if(e=Fe.urls[pe.getType()])return e}return Fe.url},this.getTransport=function(){return pe},this.getConfiguration=function(){return this._mixin(!0,{},Fe)},this.getAdvice=function(){return this._mixin(!0,{},Le)},window.WebSocket&&this.registerTransport("websocket",new a),this.registerTransport("long-polling",new i),this.registerTransport("callback-polling",new s)},u=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z",".","-",":","+","=","^","!","/","*","?","&","<",">","(",")","[","]","{","}","@","%","$","#"],d=[0,68,0,84,83,82,72,0,75,76,70,65,0,63,62,69,0,1,2,3,4,5,6,7,8,9,64,0,73,66,74,71,81,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,77,0,78,67,0,0,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,79,0,80,0,0];return{CometD:c,Transport:n,RequestTransport:r,LongPollingTransport:i,CallbackPollingTransport:s,WebSocketTransport:a,Utils:e,Z85:{encode:function(e){var t=null;if(e instanceof ArrayBuffer?t=e:e.buffer instanceof ArrayBuffer?t=e.buffer:Array.isArray(e)&&(t=new Uint8Array(e).buffer),null==t)throw"Cannot Z85 encode "+e;for(var n=t.byteLength,r=n%4,i=4-(0===r?4:r),s=new DataView(t),o="",a=0,c=0;c<n+i;++c){var d=c>=n;if(a=256*a+(d?0:s.getUint8(c)),(c+1)%4==0){for(var l=52200625,f=5;f>0;--f){if(!d||f>i){var p=Math.floor(a/l)%85;o+=u[p]}l/=85}a=0}}return o},decode:function(e){for(var t=e.length%5,n=5-(0===t?5:t),r=0;r<n;++r)e+=u[u.length-1];for(var i=e.length,s=new ArrayBuffer(4*i/5-n),o=new DataView(s),a=0,c=0,l=0,f=0;f<i;++f){var p=e.charCodeAt(c++)-32;if(a=85*a+d[p],c%5==0){for(var h=16777216;h>=1;)l<o.byteLength&&o.setUint8(l++,Math.floor(a/h)%256),h/=256;a=0}}return s}}}})},"./webapp/lib/thirdparty/jquery.cometd.js":function(e,t,n){"use strict";var r,i,s,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(a,c){"object"===o(t)?e.exports=c(n("./webapp/lib/thirdparty/jquery-3.2.1.js"),n("./webapp/lib/thirdparty/cometd.js")):(i=[n("./webapp/lib/thirdparty/jquery-3.2.1.js"),n("./webapp/lib/thirdparty/cometd.js")],r=c,void 0!==(s="function"==typeof r?r.apply(t,i):r)&&(e.exports=s))}(0,function(e,t){function n(e,t){if(t)for(var n in t)if(t.hasOwnProperty(n)){if("content-type"===n.toLowerCase())continue;e.setRequestHeader(n,t[n])}}function r(){var r=new t.LongPollingTransport,i=t.Transport.derive(r);return i.xhrSend=function(t){return e.ajax({url:t.url,async:!0!==t.sync,type:"POST",contentType:"application/json;charset=UTF-8",data:t.body,global:!1,xhrFields:{withCredentials:!0},beforeSend:function(e){return e.withCredentials=!0,n(e,t.headers),!0},success:t.onSuccess,error:function(e,n,r){t.onError(n,r)}})},i}function i(){var r=new t.CallbackPollingTransport,i=t.Transport.derive(r);return i.jsonpSend=function(t){e.ajax({url:t.url,async:!0!==t.sync,type:"GET",dataType:"jsonp",jsonp:"jsonp",data:{message:t.body},beforeSend:function(e){return n(e,t.headers),!0},success:t.onSuccess,error:function(e,n,r){t.onError(n,r)}})},i}return e.CometD=function(e){var n=new t.CometD(e);return n.unregisterTransports(),window.WebSocket&&n.registerTransport("websocket",new t.WebSocketTransport),n.registerTransport("long-polling",new r),n.registerTransport("callback-polling",new i),n},e.cometd=new e.CometD,e.cometd})},"./webapp/plugins/cx-webchat-service/cx-webchat-service.js":function(t,n,r){"use strict";var i,s,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};i=[r("./webapp/lib/thirdparty/jquery-3.2.1.js"),r("./webapp/plugins/cx-common/cx-common.js"),r("./webapp/lib/thirdparty/js.cookie.js"),r("./webapp/lib/thirdparty/cometd.js"),r("./webapp/lib/thirdparty/jquery.cometd.js")],void 0!==(s=function(t,n,r,i,s){var a=CXBus.registerPlugin("WebChatService");if(a){a.registerEvents(["ready","restored","restoreTimeout","restoreFailed","messageReceived","error","started","ended","agentTypingStarted","agentTypingStopped","pollingStarted","pollingStopped","clientConnected","clientDisconnected","agentConnected","agentDisconnected","supervisorConnected","supervisorDisconnected","clientTypingStarted","clientTypingStopped","ajaxResponse","disconnected","reconnected","chatServerWentOffline","chatServerBackOnline"]);var c=setInterval,u=!1,d=!1,l=!0,f=3e3,p={withCredentials:!1},h=!1,g={sessionID:"",userId:"",secureKey:"",alias:""},m="",v="_genesys.widgets.webchat.state",b=v+".session",y=v+".keys",T=v+".ping",w=v+".filters",x=1,C=1,k=!1,S=!1,_=!1,I=!1,j=!1,D=6e4,P="",L="",O="",R={},A=n.getBrowserandOS(),E=[],U=[],q={},F={},N=0,M=5,K=!1,B=!1,H=!1,W={enabled:!1,cometURL:"",channel:"/service/chatV2/customer-support",apiURL:"",websocketEnabled:!0,logLevel:"info"},J=!1,z=0,X=!1,G=!1,V=!1,$={Timer:0,Timeout:2e3,TimeInterval:100,Interval:!1,IdleCount:0,IdleLimit:2,Text:""},Z={standard:[/\{start\:[0-9]{9}\}/],custom:[]},Q=[],Y=!1,ee=!1,te=!1,ne={enabled:!1,maxMessagePageSize:20},re=!1,ie=!1,se=!1,oe=!1,ae="",ce=["Authorization"],ue=function(e,r,i){var s=t.Deferred(),o={alias:g.alias,secureKey:g.secureKey,userId:g.userId},i=i||{};if(i=t.extend(o,i),B)B&&(""==e?(e="requestChat",Y=s):S&&(Y=s),J?de(e,r,i,s):(Le(),n.watch(function(){return J},250).done(function(){de(e,r,i)})));else{var c=h?n.filterObjectProperties(a.data("App.requestHeader"),ce):{};"disconnect"==e&&(ee=s),t.ajax({url:L+g.sessionID+(e?"/"+e:""),type:r,crossDomain:!0,data:i,timeout:f,headers:t.extend({},{"Content-Type":"application/x-www-form-urlencoded"},c),xhrFields:p,success:function(e){e.id&&(e.sessionId=e.id),Se(e),s.resolve(e||{}),I&&(I=!1,a.publish("reconnected")),2===e.statusCode&&e.errors&&e.errors.length>0&&a.publish("error",e),a.publishDirect("ajaxResponse",e)},error:function(t){0===t.status&&(I=!0,k?a.publish("disconnected"):a.publish("error",t));var n=t.responseJSON||{};if("refresh"==e&&n.errors&&n.errors.length>0)for(var r=0;r<n.errors.length;r++)204==n.errors[r].code&&n.errors.splice(r,1);n.errors&&n.errors.length>0&&a.publish("error",t),s.reject(t||{})},beforeSend:function(e){m&&e.setRequestHeader("apikey",m)}})}return s.promise()},de=function(e,n,r,i){if(B&&H&&J){"send"==e&&(e="sendMessage");var s={operation:e,chatId:g.sessionID},o=t.extend(s,r);H.publish(W.channel,o),i&&i.resolve({statusCode:0})}else i&&i.reject("CometD is not configured or there is a connection issue")},le=function(r,i){var s=t.Deferred(),o=i.file;if(_e()){var c=new FormData,u=L+g.sessionID+(r||"");o&&c.append("file",o),B?(u=W.apiURL,c.append("operation",r)):(c.append("alias",g.alias),c.append("userId",g.userId)),c.append("secureKey",g.secureKey),t.ajax({type:"POST",url:u,mimeType:"multipart/form-data",contentType:!1,crossDomain:!0,headers:h?n.filterObjectProperties(a.data("App.requestHeader"),ce):{},timeout:f,processData:!1,data:c,beforeSend:function(e){m&&e.setRequestHeader("apikey",m)},success:function(e){e.id&&(e.sessionId=e.id),Se(e),s.resolve(e||{}),I&&(I=!1,a.publish("disconnected")),a.publishDirect("ajaxResponse",e)},error:function(e){if(t.isEmptyObject(o))a.publish("error",e);else if(400===e.status){var n=JSON.parse(e.responseText);t.each(n.errors,function(){this.filename=o.name}),e.responseText=JSON.stringify(n),a.publish("error",e),s.reject(e||{})}else 0===e.status&&(e.errorReason="FileUploadError",e.filename=o.name,e.file=o,a.publish("error",e));s.reject(e||{})}})}else e.deferred.reject("No HTMl5 formData support on your browser");return s.promise()},fe=function(e){var n=[];t.each(e.messages||[],function(){if(be(this.index)&&("Message"!=this.type||we(this.text))){for(var e=this,t=0;t<Q.length;t++)e=Q[t](e)||e;e=pe(this),he(e),n.push(e),E.push(e),U.push(this)}}),n.length>0&&a.publish("messageReceived",{originalMessages:e.messages,messages:n,restoring:S,sessionData:g,oldMessages:se}),re&&ae<=1&&(oe=!0),!0===e.chatEnded&&!0===k&&(j=!0,a.command("stopPoll"),me(),ke(),k=!1,qe(),a.publish("ended"),a.command("App.deregisterAutoLoad"))},pe=function(e){var t={};return"TypingStarted"==e.type?t.isTyping=!0:"TypingStopped"==e.type&&(t.isTyping=!1),"FileUploaded"==e.type&&(t.fileDetails=e.userData),t.text=e.text,t.type=e.type,t.index=e.index,t.timestamp=e.utcTime,t.html=e.html,t.bubble=e.bubble,t.userData=e.userData,t.from={id:e.from?parseInt(e.from.participantId):"",type:e.from?e.from.type:"",name:e.from?e.from.nickname:""},S&&(t.restoring=!0),e.index>=0&&e.index>=x&&(x=e.index+1,n.setCookie("_genesys.widgets.webchat.state.index",x)),t},he=function(e){var t=e.type,n=e.from.type,r=e.from.id,i={};if("Message"!=t&&"PushUrl"!=t&&"Notice"!=t||"Agent"!=n&&"Supervisor"!=n||a.publish("agentTypingStopped"),"ParticipantJoined"==t)switch("Agent"!=n&&"Supervisor"!=n||(q[r]={name:e.from.name,connected:!0,supervisor:"Supervisor"==n,connectedTime:e.timestamp,disconnectedTime:!1}),i={message:e,agents:q,numAgentsConnected:Te()},n){case"Client":a.publish("clientConnected",i);break;case"Agent":a.publish("agentConnected",i);break;case"Supervisor":a.publish("supervisorConnected",i)}else if("ParticipantLeft"==t)switch(q[r]&&(q[r].connected=!1,q[r].disconnectedTime=e.timestamp),i={message:e,agents:q,numAgentsConnected:Te()},n){case"Client":a.publish("clientDisconnected",i);break;case"Agent":a.publish("agentDisconnected",i),a.publish("agentTypingStopped");break;case"Supervisor":a.publish("supervisorDisconnected",i),a.publish("agentTypingStopped")}"Agent"!=n&&"Supervisor"!=n||("TypingStarted"==t&&a.publish("agentTypingStarted",e),"TypingStopped"==t&&a.publish("agentTypingStopped",e))},ge=function(){return!re&&!!(l&&n.getCookie(T)&&(new Date).getTime()-parseInt(n.getCookie(T))>=D)&&(me(),a.publish("restoreTimeout"),a.command("App.deregisterAutoLoad"),!0)},me=function(){re||(n.deleteCookie(b),n.deleteCookie(y),n.deleteCookie(T),n.deleteCookie("_genesys.widgets.webchat.state.index"),n.deleteCookie(w))},ve=function(){me(),k=!1,S=!1,d=!1,l=!0,j=!1,g.sessionID="",g.userId="",g.secureKey="",g.alias="",x=1,C=1,E=[],U=[],q={},F={},N=0,z=0,_=!1,I=!1},be=function(e){return!F[e]&&(F[e]=!0,!0)},ye=function(e,t){"string"==typeof e&&t instanceof RegExp&&(xe(t),a.command("sendMessage",{message:e}))},Te=function(){var e=0;for(var t in q)!0===q[t].connected&&e++;return e},we=function(e){for(var t=0;t<Z.standard.length;t++)if((e+"").match(Z.standard[t]))return!1;for(var t=0;t<Z.custom.length;t++)if((e+"").match(Z.custom[t]))return!1;return!0},xe=function(e){if(e instanceof RegExp){e.length||(e=[e]);for(var t=0;t<e.length;t++)Z.custom.push(e[t]);Ce()}},Ce=function(){for(var e,t={custom:[]},r=0;r<Z.custom.length;r++)e=Z.custom[r],t.custom.push({source:e.source,flags:e.flags});n.setCookie(w,JSON.stringify(t))},ke=function(){Z.custom=[],n.deleteCookie(w)},Se=function(e){if(!j){var t=g&&g.secureKey;e.chatId&&(g.sessionID=e.chatId),e.secureKey&&(g.secureKey=e.secureKey),e.alias&&(g.alias=e.alias),e.userId&&(g.userId=e.userId),re&&ne.getSessionData?t!==g.secureKey&&ne.getSessionData(g,r,n.getCookieOptions()):(n.setCookie(y,JSON.stringify({secureKey:g.secureKey,alias:g.alias,userId:g.userId})),n.setCookie(b,g.sessionID)),a.data("WebChatService.sessionData",g)}},_e=function(){return!!window.FormData},Ie=function(e){B&&(e=e.data),e.chatEnded||e.errors||Se(e),Y&&(Y.resolve(e),Y=!1,0!=e.statusCode&&qe()),0==e.statusCode?(_&&(a.publish("chatServerBackOnline"),a.publish("reconnected")),X=!1,_=!1,N=0):1==e.statusCode&&(++N>M&&(a.publish("chatServerWentOffline"),N=0),_=!0),re&&(G||ie?fe(e):G=!0),re||fe(e),l=!1,S=!1,se=!1},je=function(e){return Se(e),!0===e.chatEnded||void 0===e.chatEnded?(me(),j=!0,S=!1,g.sessionID="",g.secureKey="",g.alias="",g.userId="",a.publish("restoreTimeout"),a.command("App.deregisterAutoLoad"),qe(),!1):!1===e.chatEnded?(a.publish("restored"),fe(e),S=!1,k=!0,a.command("startPoll"),re||n.setCookie(b,g.sessionID),1==e.statusCode&&(a.publish("restoredOffline"),_=!0),!0):void 0},De=function(e){B&&e&&(e=e.data);var t={numAgentsConnected:0};k=!1,qe(),me(),a.publish("supervisorDisconnected",t),a.publish("agentDisconnected",t),a.publish("clientDisconnected",t),a.publish("ended"),a.command("App.deregisterAutoLoad"),H=!1,ee&&(ee.resolve(e),ee=!1)},Pe=function(){h&&H.configure({requestHeaders:n.filterObjectProperties(a.data("App.requestHeader"),ce)})},Le=function(){B&&(H=new t.CometD,H.websocketEnabled=W.websocketEnabled,H.configure({url:W.cometURL,logLevel:W.logLevel,requestHeaders:h?n.filterObjectProperties(a.data("App.requestHeader"),ce):{}}),H.addListener("/meta/handshake",Re),H.addListener("/meta/connect",Oe),H.addListener("/meta/disconnect",Ae),H.addListener("/meta/publish",Ee),H.addListener(W.channel,Ie),H.handshake())},Oe=function(e){if(Pe(),!H||H.isDisconnected())return void(J=!1);if(J=!0===e.successful,I&&J){if(I=!1,!_){a.publish("reconnected");var t=re?g:n.getCookie(y);ue("requestNotifications","POST",{userId:t.userId,secureKey:t.secureKey,alias:t.alias,transcriptPosition:x,message:""})}}else!I&&J?re||n.setCookie(T,(new Date).getTime()):I||J||"402::Unknown client"!=e.error&&(I=!0,a.publish("disconnected"))},Re=function(e){!1===e.successful?Y&&5==++z&&(qe(),Y.reject({statusCode:1}),Y=!1,z=0):!0===e.successful&&(J=!0,z=0)},Ae=function(e){H&&(Pe(),H.handshake(),a.publish("disconnected"),I=!0,_=!0,Ue())},Ee=function(e){},Ue=function(){if(!X&&k){var e=re?g:n.getCookie(y);X=!0,n.watch(function(t,n){return X&&ue("requestNotifications","POST",{userId:e.userId,secureKey:e.secureKey,alias:e.alias,transcriptPosition:x,message:""}),!X},3e3,30).fail(function(){M=0,a.publish("chatServerTimeout")})}},qe=function(){B&&H&&(Pe(),H.disconnect(),H=!1,J=!1)},Fe=function(){S=!1,g.sessionID="",g.secureKey="",g.alias="",g.userId="",a.publish("restoreFailed")};a.registerCommand("fetchHistory",function(e){re?(se=!0,ae-=ne.maxMessagePageSize,oe?e.deferred.reject("No more messages to fetch"):ue("refresh","POST",{userId:g.userId,secureKey:g.secureKey,alias:g.alias,transcriptPosition:ae<=0?1:ae,message:""}).done(function(t){e.deferred.resolve(t)}).fail(function(t){e.deferred.reject(t)})):e.deferred.reject("Fetching messages history applies to only Asynchronous chat.")}),a.registerCommand("configure",function(e){if(e.data&&Object.keys(e.data).length){var i=e.data,s="string",c="number",u="object",d="function",l={};if(o(i.id)!=s&&i.id!=c||(P=i.id),o(i.apikey)!=s&&o(i.apikey)!=c||(m=i.apikey),o(i.endpoint)==s&&(O=i.endpoint),o(i.userData)==u&&t.extend(R,i.userData),o(i.serverURL)==s&&(L=i.serverURL),o(i.ajaxTimeout)==c&&(f=parseInt(i.ajaxTimeout)),o(i.xhrFields)==u&&t.extend(p,i.xhrFields),"object"==o(i.cometD)&&(!0===i.cometD.enabled&&(B=!0),t.extend(W,i.cometD)),o(i.dataURL)!=s||B||(L=i.dataURL.replace(/\/*$/,""),B||(L+="/")),o(i.pollExceptionLimit)==c&&(M=parseInt(i.pollExceptionLimit)),o(i.restoreTimeout)==c&&(D=parseInt(i.restoreTimeout)),o(i.maxMessageLength)==c&&(K=i.maxMessageLength),"boolean"==typeof i.enableCustomHeader&&(h=i.enableCustomHeader),o(i.async)==u&&B){if("boolean"==o(i.async.enabled)&&(ne.enabled=i.async.enabled),o(i.async.maxMessagePageSize)==c&&(ne.maxMessagePageSize=i.async.maxMessagePageSize),o(i.async.setSessionData)==d){ne.setSessionData=i.async.setSessionData;var g=ne.setSessionData("_genesys.widgets.webchat.state.open",r,n.getCookieOptions());"undefined"!==g&&g&&"string"==typeof g&&g.length>0?l=g&&JSON.parse(g):g&&"object"==(void 0===g?"undefined":o(g))&&Object.keys(g).length&&(l=g)}o(i.async.getSessionData)==d&&(ne.getSessionData=i.async.getSessionData),re=ne.enabled&&B}n.getCookie(b)?(re=!1,a.command("restore")):Object.keys(l).length&&(B?(re=!0,a.command("restore",{sessionData:l})):e.deferred.reject("Invalid configuration. WebChatService supports Async chat only in CometD mode.")),e.deferred.resolve()}else e.deferred.reject("Invalid configuration")}),a.registerCommand("startChat",function(e){if(k)return e.deferred.reject("There is already an active chat session"),!1;e.data&&"boolean"==typeof e.data.async&&(re=e.data.async);var r={};if("string"==typeof e.data.userData&&""!=e.data.userData.trim()){try{r=JSON.parse(e.data.userData.trim())}catch(t){return e.deferred.reject("malformed JSON provided in userData property"),!1}"object"==(void 0===r?"undefined":o(r))&&(r=t.extend({},R,r))}else"object"==o(e.data.userData)&&(r=t.extend({},R,e.data.userData));var i={_genesys_source:n.isMobileDevice()?"mobile":"web",_genesys_referrer:document.referrer,_genesys_url:document.location.href,_genesys_pageTitle:document.title,_genesys_browser:A.browser,_genesys_OS:A.os};r=t.extend({GCTI_LanguageCode:te},R,i,r||{}),re&&(ie=!0,r=t.extend({GCTI_Chat_AsyncMode:"true"},r)),ve();var s={nickname:e.data.nickname||"",firstName:e.data.firstname||"",lastName:e.data.lastname||"",emailAddress:e.data.email||"",subject:e.data.subject||"",text:"",userData:r};e.da&&(s.endpoint=O),ue("","POST",s).done(function(t){0==t.statusCode?(k=!0,Se(t),a.publish("started",g),a.command("startPoll"),a.command("App.registerAutoLoad"),e.deferred.resolve(t)):e.deferred.reject(t)}).fail(function(t){e.deferred.reject(t)})}),a.registerCommand("getFileLimits",function(e){le(B?"fileGetLimits":"/file/limits",{}).done(function(t){e.deferred.resolve(t)}).fail(function(t){e.deferred.reject(t)})}),a.registerCommand("endChat",function(e){if(!k)return e.deferred.reject("There is no active chat session"),!1;a.command("stopPoll"),ue("disconnect","POST",{alias:g.alias,secureKey:g.secureKey,userId:g.userId}).fail(function(t){e.deferred.reject(t)}).always(De)}),a.registerCommand("getSessionData",function(e){e.deferred.resolve(g)}),a.registerCommand("restore",function(e){if(S)return e.deferred.reject("Already restoring. Ignoring request."),!1;if(k&&e.deferred.reject("Chat session is already active, ignoring restore command."),!re&&"WebChatService"!=e.commander)return e.deferred.reject("Access Denied to private command. Only WebChatService is allowed to invoke this command in Non-Async mode."),!1;var t,r;e.data&&e.data.async&&!0===e.data.async.enabled&&(re=!0),re?e.data&&e.data.sessionData&&(g=e.data.sessionData)&&(t=g.sessionID,r=g):(t=n.getCookie(b),r=n.getCookie(y)),"string"==typeof r&&r.length>0&&(r=JSON.parse(r)),t&&r&&!ge()&&(me(),S=!0,g.sessionID=t,re?ue("refresh","POST",{userId:r.userId,secureKey:r.secureKey,alias:r.alias,transcriptPosition:Number(-1)}).done(function(t){!1===t.chatEnded&&t.messages.length>0?"number"==typeof(x=parseInt(t.messages[0].index))&&(ae=parseInt(x-ne.maxMessagePageSize),ae=ae<=0?1:ae,ue("requestNotifications","POST",{userId:r.userId,secureKey:r.secureKey,alias:r.alias,transcriptPosition:ae,message:""}).done(function(t){t&&0==t.statusCode?(S=!1,k=!0,a.publish("restored",{async:!0}),a.data("WebChatService.mode",{async:!0}),e.deferred.resolve(t)):e.deferred.reject(t)}).fail(function(t){Fe(),e.deferred.reject()})):e.deferred.reject(t)}).fail(function(t){Fe(),e.deferred.reject()}):ue(B?"requestNotifications":"refresh","POST",{userId:r.userId,secureKey:r.secureKey,alias:r.alias,transcriptPosition:x,message:""}).done(function(t){!0===je(t)?e.deferred.resolve(t):e.deferred.reject(t)}).fail(function(t){Fe(),e.deferred.reject()}))}),a.registerCommand("sendMessage",function(e){return I?(e.deferred.resolve({statusCode:1}),!1):k?"string"!=typeof e.data.message||""==(e.data.message+"").trim()?(e.deferred.reject("No message text provided"),!1):K&&e.data.message.length>K?(e.deferred.reject("Message length exceeds configured threshold of ("+K+") characters"),!1):($.Interval&&a.publish("clientTypingStopped"),clearInterval($.Interval),$.Interval=!1,$.Timer=0,$.text="",$.IdleCount=0,void ue("send","POST",{message:e.data.message,messageType:e.data.type||"text",userId:g.userId,secureKey:g.secureKey,alias:g.alias}).done(function(t){e.deferred.resolve(t)}).fail(function(t){e.deferred.reject(t)})):(e.deferred.reject("There is no active chat session"),!1)}),a.registerCommand("sendFile",function(e){if(!k)return e.deferred.reject("There is no active chat session"),!1;var n=!1,r=e.data.files,i=r.files[0],s=i.name,o={},a=B?"fileUpload":"/file";o.file=i,n=le(a,o),n.done(function(n){if(n=JSON.parse(n),0==n.statusCode){var r=new FileReader;t(r).on("load",function(t){var r=t.target.result,i=[],o={from:{type:"Client"},source:r,type:"FileUploaded",timestamp:(new Date).getTime(),filename:s};i.push(o),e.deferred.resolve(n)}),r.readAsDataURL(i)}else e.deferred.reject(n)}).fail(function(t){e.deferred.reject(t)})}),a.registerCommand("downloadFile",function(e){var n;if(B&&W.apiURL)n=t("<form method='POST' enctype='multipart/form-data' target='_blank' action="+W.apiURL+"><input name='secureKey' value="+g.secureKey+" type='hidden'><input name='fileId' value="+e.data.fileId+" type='hidden'><input name='operation' value='fileDownload' type='hidden'></form>").appendTo(document.body).submit(),e.deferred.resolve();else if(B)e.deferred.reject("Could not download file. Please ensure WebChat is configured properly.");else{var r=L+g.sessionID+"/file/"+e.data.fileId+"/download";n=t("<form method='POST' enctype='multipart/form-data' target='_blank' action="+r+"><input name='alias' value="+g.alias+" type='hidden'><input name='secureKey' value="+g.secureKey+" type='hidden'><input name='userId' value="+g.userId+" type='hidden'></form>").appendTo(document.body).submit(),e.deferred.resolve()}n&&n.submit()}),a.registerCommand("sendFilteredMessage",function(e){k?(ye(e.data.message,e.data.regex),e.deferred.resolve()):e.deferred.reject("No active chat session.")}),a.registerCommand("addPrefilter",function(e){if(e.data.filters&&e.data.filters instanceof RegExp)xe(e.data.filters),e.deferred.resolve(t.extend({},Z.custom));else if(e.data.filters.length>0&&e.data.filters[0]instanceof RegExp){for(var n=0;n<e.data.filters.length;n++)xe(e.data.filters[n]);e.deferred.resolve(t.extend({},Z.custom))}else e.deferred.reject("Missing or invalid filters provided. Please provide a regular expression or an array of regular expressions")}),a.registerCommand("startPoll",function(e){return B?(e.deferred.reject("Polling is not supported when using CometD"),!1):k?(!1===u&&(u=c(function(){a.command("poll")},3e3),a.command("poll"),a.publish("pollingStarted")),void e.deferred.resolve()):(e.deferred.reject("There is no active chat session"),!1)}),a.registerCommand("stopPoll",function(e){if(0==u)return e.deferred.reject("Not currently polling. Ignoring command."),!1;0!=u&&(clearInterval(u),u=!1,a.publish("pollingStopped")),e.deferred.resolve()}),a.registerCommand("poll",function(e){e.commander!=a.namespace()&&e.deferred.reject("Access Denied to private command. Only WebChatService is allowed to invoke this command"),d?e.deferred.reject("previous poll has not finished"):(d=!0,re||n.setCookie(T,(new Date).getTime()),ue("refresh","POST",{userId:g.userId,secureKey:g.secureKey,alias:g.alias,transcriptPosition:x,message:V?V.val():""}).done(function(t){Ie(t),e.deferred.resolve(t)}).fail(function(t){e.deferred.reject(t)}).always(function(){d=!1}))}),a.registerCommand("resetPollExceptions",function(e){_=!1,N=0,e.deferred.resolve()}),a.registerCommand("sendCustomNotice",function(e){ue("customNotice","POST",{alias:g.alias,secureKey:g.secureKey,userId:g.userId,message:e.data.message||""}).done(function(t){e.deferred.resolve(t)}).fail(function(t){e.deferred.reject(t)})}),a.registerCommand("updateUserData",function(e){k?ue("updateData","POST",{alias:g.alias,secureKey:g.secureKey,userId:g.userId,userData:e.data||{}}).done(function(t){e.deferred.resolve(t)}).fail(function(t){e.deferred.reject(t)}):(t.extend(R,e.data||{}),e.deferred.resolve(R))}),a.registerCommand("sendTyping",function(e){if(!k)return e.deferred.reject("There is no active chat session"),!1;var t=e.data||{},n=!1,r=$,i={alias:g.alias,secureKey:g.secureKey,userId:g.userId,transcriptPosition:x};if("boolean"!=typeof t.isTyping&&(t.isTyping=!0),B)i.message=V.val()||"",r.Interval||(r.Interval=setInterval(function(){V&&V.val()!=r.text?(i.message=V.val()||"",n=ue("startTyping","POST",i),r.text=V.val()):++r.IdleCount==r.IdleLimit&&(clearInterval(r.Interval),r.IdleCount=0,r.Interval=!1,i.message=V.val()||"",n=ue("stopTyping","POST",i))},5e3),n=ue("startTyping","POST",i));else{if(r.Interval)return r.Timer=0,e.deferred.resolve(),!1;i.message=t.message||"",n=ue("startTyping","POST",i),a.publish("clientTypingStarted"),r.Interval=setInterval(function(){r.Timer+=r.TimeInterval,r.Timer>=r.Timeout&&(i.message=t.message||"",clearInterval(r.Interval),r.Interval=!1,r.Timer=0,n=ue("stopTyping","POST",i),a.publish("clientTypingStopped"))},r.TimeInterval),n.done(function(t){e.deferred.resolve(t)}).fail(function(t){e.deferred.reject(t)})}}),a.registerCommand("getAgents",function(e){e.deferred.resolve({agents:t.extend(q,{})})}),a.registerCommand("getTranscript",function(e){e.deferred.resolve({messages:E,originalMessages:U})}),a.registerCommand("getStats",function(e){var n={agents:t.extend(q,{}),startTime:!1,endTime:!1,duration:!1};E.length>0&&(n.startTime=E[0].timestamp,n.endTime=E[E.length-1].timestamp,n.duration=n.endTime-n.startTime),e.deferred.resolve(n)}),a.registerCommand("registerTypingPreviewInput",function(e){var n=t(e.data.input);!n||"text"!=n[0].type&&"textarea"!=n[0].type?e.deferred.reject("Invalid value provided for the 'input' property. An HTML element reference to a textarea or text input is required."):(V=n,e.deferred.resolve())}),a.registerCommand("registerPreProcessor",function(e){"function"==typeof e.data.preprocessor?(Q.push(e.data.preprocessor),e.deferred.resolve(e.data.preprocessor)):e.deferred.reject("No preprocessor function provided. Type provided was '"+o(e.data.preprocessor)+"'.")}),a.subscribe("GWE.ready",function(){a.command("GWE.getIDs").done(function(e){t.extend(R,e)})}),a.subscribe("App.language",function(e){te=e.data}),function(){if(n.getCookie(w)){var e=JSON.parse(n.getCookie(w));t.each(e.custom,function(){Z.custom.push(new RegExp(this.source,this.flags))})}}(),a.command("configure",_genesys.widgets.webchat),a.ready(),a.republish("ready")}}.apply(n,i))&&(t.exports=s)}},["./webapp/plugins/cx-webchat-service/cx-webchat-service.js"]);